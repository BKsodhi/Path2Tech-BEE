<%
    // Ensure the title is passed to the layout
    title = "Admin - User Progress"
    currentPath = "/admin/userProgress" // Added for navbar highlighting
%>

<style>
/* Reusing Admin styles for consistency */
:root {
--primary-charcoal: #1C232B;
--primary-dark: #12181F;
--accent-neon: #00FFD1;
--text-color: #F5F7FA;
--pass-color: #A3FF00; /* Lime for Pass/Complete */
--fail-color: #FF0066; /* Red for Fail/Incomplete */
}

.admin-header {
color: var(--accent-neon);
text-shadow: 0 0 10px rgba(0, 255, 209, 0.4);
letter-spacing: 2px;
margin-bottom: 30px;
text-transform: uppercase;
}

/* TABLE STYLING */
.table-console {
background-color: var(--primary-dark); 
color: var(--text-color);
border: 1px solid var(--primary-charcoal); 
border-radius: 8px;
 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
}
 /* Table Header */
.table-console thead th {
background-color: var(--primary-charcoal);
color: var(--accent-neon);
border-bottom: 3px solid var(--accent-neon); 
font-weight: 700;
text-transform: uppercase;
letter-spacing: 0.5px;
}
/* Table Body */
 .table-console tbody td {
border-top: 1px dashed var(--primary-charcoal); 
border-bottom: none;
 padding: 12px 10px;
}

/* Table Striping and Hover */
.table-console tbody tr:nth-of-type(odd) {
background-color: var(--primary-dark);
}
.table-console tbody tr:nth-of-type(even) {
background-color: var(--primary-charcoal);
}
.table-console tbody tr:hover {
background-color: #283743 !important;
}

/* Status Indicators */
.status-pass {
color: var(--pass-color);
font-weight: 700;
text-shadow: 0 0 5px rgba(163, 255, 0, 0.5);
}
.status-fail {
color: var(--fail-color);
font-weight: 700;
text-shadow: 0 0 5px rgba(255, 0, 102, 0.5);
}

</style>

<div class="container my-5">
    <h2 class="admin-header"><i class="bi bi-graph-up-arrow me-2"></i> User Progress Tracking</h2>

    <div class="table-responsive">
        <table class="table table-console">
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>Email</th>
                    <th>Subject</th>
                    <th>Difficulty</th>
                    <th>Score (%)</th>
                    <th>Status</th>
                    <th>Last Attempt</th>
                </tr>
            </thead>
            <tbody>
            <% if (typeof progressRecords !== 'undefined' && progressRecords.length > 0) { %>
                <% progressRecords.forEach(record => { 
                    // Assuming the 'score' is a number from 0 to 100
                    const isPass = record.score >= 70; // Assuming 70% is passing

                    // Handle potential null or non-existent last_attempt date
                    let attemptDate = 'N/A';
                    if (record.last_attempt) {
                        try {
                            // Converts PostgreSQL timestamp to a readable string
                            attemptDate = new Date(record.last_attempt).toLocaleString('en-US', {
                                year: 'numeric', month: 'short', day: 'numeric',
                                hour: '2-digit', minute: '2-digit'
                            });
                        } catch (e) {
                            attemptDate = 'Invalid Date';
                        }
                    }
                %>
                    <tr>
                        <td><%= record.userid %></td>                         <td><%= record.useremail %></td>                         <td><%= record.subject %></td>
                        <td><%= record.difficulty %></td>
                        <td><%= record.score.toFixed(1) %>%</td>
                        <td class="<%= isPass ? 'status-pass' : 'status-fail' %>">
                            <i class="bi <%= isPass ? 'bi-check-circle-fill' : 'bi-x-circle-fill' %> me-1"></i>
                            <%= isPass ? 'Complete' : 'Incomplete' %>
                        </td>
                        <td><%= attemptDate %></td>
                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td colspan="7" class="text-center" style="color: var(--accent-neon);">
<i class="bi bi-info-circle me-2"></i> No progress records found.
 </td>
</tr>
<% } %>
</tbody>
</table>
</div>
</div>
<%- include('../partials/navbar') %>

<div class="min-h-screen bg-light p-4">
  <div class="row">
    <!-- Left half: Question -->
    <div class="col-md-6">
      <div class="bg-white shadow-sm p-4 rounded-3">
        <h3 class="text-primary fw-bold"><%= question.title %></h3>
        <p class="mt-3"><%= question.description %></p>

        <h5 class="mt-4 fw-semibold">Example Input:</h5>
        <pre class="bg-light p-2 rounded"><%= question.inputExample %></pre>

        <h5 class="mt-3 fw-semibold">Expected Output:</h5>
        <pre class="bg-light p-2 rounded"><%= question.outputExample %></pre>
      </div>
    </div>

    <!-- Right half: Code editor -->
    <div class="col-md-6 d-flex flex-column">
      <div class="bg-white shadow-sm p-3 rounded-3 flex-grow-1 d-flex flex-column">
        <h4 class="text-primary fw-semibold mb-3">Write Your Code (Java):</h4>

        <textarea
          id="codeEditor"
          class="form-control flex-grow-1 font-monospace"
          rows="14"
        >public class Main {
    public static void main(String[] args) throws Exception {
        java.util.Scanner sc = new java.util.Scanner(System.in);
        int[] nums = {2,7,11,15};
        int target = 9;
        // Write logic here
        System.out.println("[0,1]");
    }
}</textarea>

        <div class="d-flex justify-content-end mt-3">
          <button id="runBtn" class="btn btn-primary me-2">Run</button>
          <button id="submitBtn" class="btn btn-success">Submit</button>
        </div>

        <div id="outputBox" class="border mt-3 p-2 rounded bg-light d-none"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const runBtn = document.getElementById("runBtn");
  const submitBtn = document.getElementById("submitBtn");
  const codeEditor = document.getElementById("codeEditor");
  const outputBox = document.getElementById("outputBox");

  function showOutput(text, success = true) {
    outputBox.classList.remove("d-none");
    outputBox.style.borderColor = success ? "#28a745" : "#dc3545";
    outputBox.innerHTML = text.replace(/\n/g, "<br>");
  }

  // ✅ Run Java code via backend compiler
  runBtn.addEventListener("click", async () => {
    const userCode = codeEditor.value.trim();
    const problemId = "<%= question.id %>";
    showOutput("⏳ Running your code...");

    try {
      const response = await fetch(`/coding/run/${problemId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code: userCode })
      });

      const data = await response.json();

      if (data.error) {
        showOutput(`<strong>Error:</strong> ${data.error}`, false);
      } else if (data.result) {
        showOutput(`<strong>Output:</strong><br>${data.result.output}`, true);
      } else {
        showOutput("⚠️ No response received.", false);
      }
    } catch (err) {
      showOutput("❌ Failed to connect to backend: " + err.message, false);
    }
  });

  // ✅ Submit button (same API for now)
  submitBtn.addEventListener("click", async () => {
    const userCode = codeEditor.value.trim();
    const problemId = "<%= question.id %>";
    showOutput("⏳ Submitting your code for evaluation...");

    try {
      const response = await fetch(`/coding/submit/${problemId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code: userCode })
      });

      const data = await response.json();

      if (data.error) {
        showOutput(`<strong>Error:</strong> ${data.error}`, false);
      } else {
        showOutput(
          `<strong>Result:</strong><br>${data.passed}/${data.total} test cases passed.`,
          true
        );
      }
    } catch (err) {
      showOutput("❌ Failed to connect to backend: " + err.message, false);
    }
  });
</script>
